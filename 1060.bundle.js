/*! For license information please see 1060.bundle.js.LICENSE.txt */
(self.webpackChunkrlayers=self.webpackChunkrlayers||[]).push([[1060],{4748:t=>{"use strict";function e(t,e){this.x=t,this.y=e}t.exports=e,e.prototype={clone:function(){return new e(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,r=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=r,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),i=e*this.x-r*this.y,n=r*this.x+e*this.y;return this.x=i,this.y=n,this},_rotateAround:function(t,e){var r=Math.cos(t),i=Math.sin(t),n=e.x+r*(this.x-e.x)-i*(this.y-e.y),o=e.y+i*(this.x-e.x)+r*(this.y-e.y);return this.x=n,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},e.convert=function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t}},4537:(t,e,r)=>{t.exports.VectorTile=r(7054),r(8729),r(6241)},7054:(t,e,r)=>{"use strict";var i=r(6241);function n(t,e,r){if(3===t){var n=new i(r,r.readVarint()+r.pos);n.length&&(e[n.name]=n)}}t.exports=function(t,e){this.layers=t.readFields(n,{},e)}},8729:(t,e,r)=>{"use strict";var i=r(4748);function n(t,e,r,i,n){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=n,t.readFields(o,this,e)}function o(t,e,r){1==t?e.id=r.readVarint():2==t?function(t,e){for(var r=t.readVarint()+t.pos;t.pos<r;){var i=e._keys[t.readVarint()],n=e._values[t.readVarint()];e.properties[i]=n}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function s(t){for(var e,r,i=0,n=0,o=t.length,s=o-1;n<o;s=n++)e=t[n],i+=((r=t[s]).x-e.x)*(e.y+r.y);return i}t.exports=n,n.types=["Unknown","Point","LineString","Polygon"],n.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,n=1,o=0,s=0,a=0,u=[];t.pos<r;){if(o<=0){var h=t.readVarint();n=7&h,o=h>>3}if(o--,1===n||2===n)s+=t.readSVarint(),a+=t.readSVarint(),1===n&&(e&&u.push(e),e=[]),e.push(new i(s,a));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&u.push(e),u},n.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,i=0,n=0,o=0,s=1/0,a=-1/0,u=1/0,h=-1/0;t.pos<e;){if(i<=0){var l=t.readVarint();r=7&l,i=l>>3}if(i--,1===r||2===r)(n+=t.readSVarint())<s&&(s=n),n>a&&(a=n),(o+=t.readSVarint())<u&&(u=o),o>h&&(h=o);else if(7!==r)throw new Error("unknown command "+r)}return[s,u,a,h]},n.prototype.toGeoJSON=function(t,e,r){var i,o,a=this.extent*Math.pow(2,r),u=this.extent*t,h=this.extent*e,l=this.loadGeometry(),d=n.types[this.type];function c(t){for(var e=0;e<t.length;e++){var r=t[e],i=180-360*(r.y+h)/a;t[e]=[360*(r.x+u)/a-180,360/Math.PI*Math.atan(Math.exp(i*Math.PI/180))-90]}}switch(this.type){case 1:var f=[];for(i=0;i<l.length;i++)f[i]=l[i][0];c(l=f);break;case 2:for(i=0;i<l.length;i++)c(l[i]);break;case 3:for(l=function(t){var e=t.length;if(e<=1)return[t];for(var r,i,n=[],o=0;o<e;o++){var a=s(t[o]);0!==a&&(void 0===i&&(i=a<0),i===a<0?(r&&n.push(r),r=[t[o]]):r.push(t[o]))}return r&&n.push(r),n}(l),i=0;i<l.length;i++)for(o=0;o<l[i].length;o++)c(l[i][o])}1===l.length?l=l[0]:d="Multi"+d;var p={type:"Feature",geometry:{type:d,coordinates:l},properties:this.properties};return"id"in this&&(p.id=this.id),p}},6241:(t,e,r)=>{"use strict";var i=r(8729);function n(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(o,this,e),this.length=this._features.length}function o(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(t){for(var e=null,r=t.readVarint()+t.pos;t.pos<r;){var i=t.readVarint()>>3;e=1===i?t.readString():2===i?t.readFloat():3===i?t.readDouble():4===i?t.readVarint64():5===i?t.readVarint():6===i?t.readSVarint():7===i?t.readBoolean():null}return e}(r))}t.exports=n,n.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new i(this._pbf,e,this.extent,this._keys,this._values)}},251:(t,e)=>{e.read=function(t,e,r,i,n){var o,s,a=8*n-i-1,u=(1<<a)-1,h=u>>1,l=-7,d=r?n-1:0,c=r?-1:1,f=t[e+d];for(d+=c,o=f&(1<<-l)-1,f>>=-l,l+=a;l>0;o=256*o+t[e+d],d+=c,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=i;l>0;s=256*s+t[e+d],d+=c,l-=8);if(0===o)o=1-h;else{if(o===u)return s?NaN:1/0*(f?-1:1);s+=Math.pow(2,i),o-=h}return(f?-1:1)*s*Math.pow(2,o-i)},e.write=function(t,e,r,i,n,o){var s,a,u,h=8*o-n-1,l=(1<<h)-1,d=l>>1,c=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,f=i?0:o-1,p=i?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=l):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),(e+=s+d>=1?c/u:c*Math.pow(2,1-d))*u>=2&&(s++,u/=2),s+d>=l?(a=0,s=l):s+d>=1?(a=(e*u-1)*Math.pow(2,n),s+=d):(a=e*Math.pow(2,d-1)*Math.pow(2,n),s=0));n>=8;t[r+f]=255&a,f+=p,a/=256,n-=8);for(s=s<<n|a,h+=n;h>0;t[r+f]=255&s,f+=p,s/=256,h-=8);t[r+f-p]|=128*y}},5335:(t,e,r)=>{"use strict";t.exports=n;var i=r(251);function n(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}n.Varint=0,n.Fixed64=1,n.Bytes=2,n.Fixed32=5;var o=4294967296,s=1/o,a="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");function u(t){return t.type===n.Bytes?t.readVarint()+t.pos:t.pos+1}function h(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function l(t,e,r){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(i);for(var n=r.pos-1;n>=t;n--)r.buf[n+i]=r.buf[n]}function d(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function c(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function f(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function p(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function y(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function w(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function v(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function g(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function m(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function b(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function x(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function F(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}n.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),n=i>>3,o=this.pos;this.type=7&i,t(n,e,this),this.pos===o&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=b(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=F(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=b(this.buf,this.pos)+b(this.buf,this.pos+4)*o;return this.pos+=8,t},readSFixed64:function(){var t=b(this.buf,this.pos)+F(this.buf,this.pos+4)*o;return this.pos+=8,t},readFloat:function(){var t=i.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=i.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,i=this.buf;return e=127&(r=i[this.pos++]),r<128?e:(e|=(127&(r=i[this.pos++]))<<7,r<128?e:(e|=(127&(r=i[this.pos++]))<<14,r<128?e:(e|=(127&(r=i[this.pos++]))<<21,r<128?e:function(t,e,r){var i,n,o=r.buf;if(i=(112&(n=o[r.pos++]))>>4,n<128)return h(t,i,e);if(i|=(127&(n=o[r.pos++]))<<3,n<128)return h(t,i,e);if(i|=(127&(n=o[r.pos++]))<<10,n<128)return h(t,i,e);if(i|=(127&(n=o[r.pos++]))<<17,n<128)return h(t,i,e);if(i|=(127&(n=o[r.pos++]))<<24,n<128)return h(t,i,e);if(i|=(1&(n=o[r.pos++]))<<31,n<128)return h(t,i,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&a?function(t,e,r){return a.decode(t.subarray(e,r))}(this.buf,e,t):function(t,e,r){for(var i="",n=e;n<r;){var o,s,a,u=t[n],h=null,l=u>239?4:u>223?3:u>191?2:1;if(n+l>r)break;1===l?u<128&&(h=u):2===l?128==(192&(o=t[n+1]))&&(h=(31&u)<<6|63&o)<=127&&(h=null):3===l?(o=t[n+1],s=t[n+2],128==(192&o)&&128==(192&s)&&((h=(15&u)<<12|(63&o)<<6|63&s)<=2047||h>=55296&&h<=57343)&&(h=null)):4===l&&(o=t[n+1],s=t[n+2],a=t[n+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&((h=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||h>=1114112)&&(h=null)),null===h?(h=65533,l=1):h>65535&&(h-=65536,i+=String.fromCharCode(h>>>10&1023|55296),h=56320|1023&h),i+=String.fromCharCode(h),n+=l}return i}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==n.Bytes)return t.push(this.readVarint(e));var r=u(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==n.Bytes)return t.push(this.readSVarint());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==n.Bytes)return t.push(this.readBoolean());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==n.Bytes)return t.push(this.readFloat());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==n.Bytes)return t.push(this.readDouble());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==n.Bytes)return t.push(this.readFixed32());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==n.Bytes)return t.push(this.readSFixed32());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==n.Bytes)return t.push(this.readFixed64());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==n.Bytes)return t.push(this.readSFixed64());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===n.Varint)for(;this.buf[this.pos++]>127;);else if(e===n.Bytes)this.pos=this.readVarint()+this.pos;else if(e===n.Fixed32)this.pos+=4;else{if(e!==n.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),x(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),x(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),x(this.buf,-1&t,this.pos),x(this.buf,Math.floor(t*s),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),x(this.buf,-1&t,this.pos),x(this.buf,Math.floor(t*s),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,i;if(t>=0?(r=t%4294967296|0,i=t/4294967296|0):(i=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,i=i+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t}(r,0,e),function(t,e){var r=(7&t)<<4;e.buf[e.pos++]|=r|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(i,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var i,n,o=0;o<e.length;o++){if((i=e.charCodeAt(o))>55295&&i<57344){if(!n){i>56319||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):n=i;continue}if(i<56320){t[r++]=239,t[r++]=191,t[r++]=189,n=i;continue}i=n-55296<<10|i-56320|65536,n=null}else n&&(t[r++]=239,t[r++]=191,t[r++]=189,n=null);i<128?t[r++]=i:(i<2048?t[r++]=i>>6|192:(i<65536?t[r++]=i>>12|224:(t[r++]=i>>18|240,t[r++]=i>>12&63|128),t[r++]=i>>6&63|128),t[r++]=63&i|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&l(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),i.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),i.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var i=this.pos-r;i>=128&&l(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,r){this.writeTag(t,n.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,c,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,y,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,p,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,w,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,v,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,g,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,m,e)},writeBytesField:function(t,e){this.writeTag(t,n.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,n.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,n.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,n.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,n.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,n.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,n.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,n.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,n.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,n.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},1060:(t,e,r)=>{"use strict";var i;r.r(e),r.d(e,{MBTilesFormat:()=>V,MBTilesRasterSource:()=>C,MBTilesVectorSource:()=>T,importMBTiles:()=>B}),globalThis.sqlite3Worker1Promiser=function t(e=t.defaultConfig){if(1===arguments.length&&"function"==typeof arguments[0]){const r=e;(e=Object.assign(Object.create(null),t.defaultConfig)).onready=r}else e=Object.assign(Object.create(null),t.defaultConfig,e);const r=Object.create(null),i=function(){},n=e.onerror||i,o=e.debug||i,s=e.generateMessageId?void 0:Object.create(null),a=e.generateMessageId||function(t){return t.type+"#"+(s[t.type]=(s[t.type]||0)+1)},u=(...t)=>{throw new Error(t.join(" "))};let h;return e.worker||(e.worker=t.defaultConfig.worker),"function"==typeof e.worker&&(e.worker=e.worker()),e.worker.onmessage=function(t){t=t.data,o("worker1.onmessage",t);let i=r[t.messageId];if(!i)return t&&"sqlite3-api"===t.type&&"worker1-ready"===t.result?void(e.onready&&e.onready()):(i=r[t.type],i&&i.onrow?void i.onrow(t):void(e.onunhandled?e.onunhandled(arguments[0]):n("sqlite3Worker1Promiser() unhandled worker message:",t)));switch(delete r[t.messageId],t.type){case"error":return void i.reject(t);case"open":h||(h=t.dbId);break;case"close":t.dbId===h&&(h=void 0)}try{i.resolve(t)}catch(t){i.reject(t)}},function(){let t;1===arguments.length?t=arguments[0]:2===arguments.length?(t=Object.create(null),t.type=arguments[0],t.args=arguments[1]):u("Invalid arugments for sqlite3Worker1Promiser()-created factory."),t.dbId||(t.dbId=h),t.messageId=a(t),t.departureTime=performance.now();const i=Object.create(null);let n;i.message=t,"exec"===t.type&&t.args&&("function"==typeof t.args.callback?(n=t.messageId+":row",i.onrow=t.args.callback,t.args.callback=n,r[n]=i):"string"==typeof t.args.callback&&u("exec callback may not be a string when using the Promise interface."));let s=new Promise((function(n,s){i.resolve=n,i.reject=s,r[t.messageId]=i,o("Posting",t.type,"message to Worker dbId="+(h||"default")+":",t),e.worker.postMessage(t)}));return n&&(s=s.finally((()=>delete r[n]))),s}},globalThis.sqlite3Worker1Promiser.defaultConfig={worker:function(){return new Worker(new URL(r.p+r.u(1901),r.b),{type:void 0})},onerror:(...t)=>console.error("worker1 promiser error",...t)};const n={timeout:2e4,maxPageSize:4096,cacheSize:1024,headers:{}};var o;!function(t){t[t.WORKMSG=16777215]="WORKMSG",t[t.HANDSHAKE=16777214]="HANDSHAKE"}(o=o||(o={}));const s="undefined"!=typeof SQLITE_DEBUG&&SQLITE_DEBUG||void 0!==(null===(i=void 0==={env:{RLAYERS_DEBUG:void 0}}?void 0:{RLAYERS_DEBUG:void 0})||void 0===i?void 0:i.SQLITE_DEBUG)&&{RLAYERS_DEBUG:void 0}.SQLITE_DEBUG||"",a=["threads","vfs","cache","http"],u={};for(const t of a)u[t]=s.includes(t)?console.debug.bind(console):()=>{};!function(){const t=new ArrayBuffer(2),e=new Uint8Array(t),r=new Uint16Array(t);if(e[0]=240,e[1]=13,61453==r[0])return u.threads("System is Big-Endian"),!1;if(3568==r[0])return u.threads("System is Little-Endian"),!0;throw new Error(`Failed determining endianness: ${r}`)}();var h=function(t,e,r,i){return new(r||(r=Promise))((function(n,o){function s(t){try{u(i.next(t))}catch(t){o(t)}}function a(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))};function l(t){let e;return u.threads("Creating new SQLite thread",t),new Promise(((i,n)=>{const o=sqlite3Worker1Promiser({onready:()=>{i(o)},worker:()=>{try{e=new Worker(new URL(r.p+r.u(7985),r.b)),e.onerror=t=>console.error("Worker bootstrap failed",t);const i=null==t?void 0:t.http;return"shared"===(null==i?void 0:i.type)?i.createNewChannel().then((t=>{e.postMessage({httpChannel:t,httpOptions:i.options},[t.port])})):"sync"===(null==i?void 0:i.type)?e.postMessage({httpChannel:!0,httpOptions:i.options}):e.postMessage({}),e}catch(t){console.error("Failed to create SQLite worker",t),n(t)}}})})).then((t=>(t.close=()=>{e.terminate()},t)))}const d='SharedArrayBuffer is not available. If your browser supports it, the webserver must send "Cross-Origin-Opener-Policy: same-origin "and "Cross-Origin-Embedder-Policy: require-corp" headers. Alternatively, if you do not intend to use concurrent connections, pass `sync` to `createHttpBackend` to explicitly create a synchronous HTTP backend and suppress this warning message.';function c(t){var e;return h(this,void 0,void 0,(function*(){const i=function(t){if(u.threads("Creating new HTTP VFS backend thread"),"undefined"==typeof SharedArrayBuffer||"sync"===(null==t?void 0:t.backendType)){if("shared"===(null==t?void 0:t.backendType))throw new Error(d);return"sync"!==(null==t?void 0:t.backendType)&&console.warn(d+" Falling back to the legacy HTTP backend."),{type:"sync",worker:null,options:t,createNewChannel:()=>{throw new Error("Sync backend does not support channels")},close:()=>Promise.resolve(),terminate:()=>{}}}let e=1;const i=new Worker(new URL(r.p+r.u(5806),r.b));i.postMessage({msg:"init",options:t});const o={};return i.onmessage=({data:t})=>{if(u.threads("Received control message reply",t),"ack"===t.msg)return o[t.id]?(u.threads("New HTTP VFS channel created",o),o[t.id].resolve({port:o[t.id].channel.port2,shm:t.shm}),clearTimeout(o[t.id].timeout),delete o[t.id].resolve,void delete o[t.id].timeout):void console.error("Invalid response received from backend",t)},{type:"shared",worker:i,options:t,createNewChannel:function(){u.threads("Creating a new HTTP VFS channel");const r=new MessageChannel,s=e++;return i.postMessage({msg:"handshake",port:r.port1,id:s},[r.port1]),new Promise(((e,i)=>{var a;const u=setTimeout((()=>{delete o[s],i("Timeout while waiting on backend")}),null!==(a=null==t?void 0:t.timeout)&&void 0!==a?a:n.timeout);o[s]={id:s,channel:r,resolve:e,timeout:u}}))},terminate:function(){i.terminate()},close:function(){return u.threads("Closing the HTTP VFS channel"),i.postMessage({msg:"close"}),new Promise(((e,r)=>{var o;const s=setTimeout((()=>{r("Timeout while waiting on backend")}),null!==(o=null==t?void 0:t.timeout)&&void 0!==o?o:n.timeout);i.onmessage=({data:t})=>{u.threads("Received close response",t),"ack"===t.msg&&void 0===t.id&&(e(),clearTimeout(s))}}))}}}(null==t?void 0:t.httpOptions),o=[],s=[];for(let r=0;r<(null!==(e=t.workers)&&void 0!==e?e:1);r++)s.push(l({http:i}).then((t=>o.push({worker:t,busy:null}))).then((()=>{})));return yield Promise.all(s),{backendType:i.type,open:t=>Promise.all(o.map((e=>e.worker("open",{filename:"file:"+encodeURI(t),vfs:"http"})))).then((()=>{})),close:()=>Promise.all(o.map((t=>t.worker.close()))).then((()=>i.close())),exec:function(t,e,r){return h(this,void 0,void 0,(function*(){let i;do{i=o.find((t=>!t.busy)),i||(yield Promise.race(o.map((t=>t.busy))).catch((()=>{})))}while(!i);const n=[];return i.busy=i.worker("exec",{sql:t,bind:e,rowMode:null==r?void 0:r.rowMode,callback:t=>{t.row&&n.push(t)}}).then((()=>{})).finally((()=>{if(!i)throw new Error("Lost worker pool");i.busy=null})),yield i.busy,n}))}}}))}var f,p=r(3407),y=r(915),w=r(6758),v=r(5620),g=r(5335),m=r(4537),b=r(3075),x=r(8217),F=r(5286),k=r(4778),P=r(8512),S=r(1078);const M="undefined"!=typeof OL_MBTILES_DEBUG&&OL_MBTILES_DEBUG||void 0!==(null===(f=void 0==={env:{RLAYERS_DEBUG:void 0}}?void 0:{RLAYERS_DEBUG:void 0})||void 0===f?void 0:f.OL_MBTILES_DEBUG)&&{RLAYERS_DEBUG:void 0}.OL_MBTILES_DEBUG?console.debug.bind(console):()=>{},_={jpg:{type:"raster",mime:"image/jpeg"},png:{type:"raster",mime:"image/png"},webp:{type:"raster",mime:"image/webp"},pbf:{type:"vector"},mvt:{type:"vector"}};function E(t){var e,r,i;return{workers:null!==(e=null==t?void 0:t.sqlWorkers)&&void 0!==e?e:4,httpOptions:{backendType:null==t?void 0:t.backendType,maxPageSize:null!==(r=null==t?void 0:t.maxSqlPageSize)&&void 0!==r?r:4096,cacheSize:null!==(i=null==t?void 0:t.sqlCacheSize)&&void 0!==i?i:4096}}}function B(t){const e=c(E(t));return e.then((e=>e.open(t.url).then((()=>e)))).then((t=>t.exec("SELECT name,value FROM metadata"))).then((t=>{if(t&&t.length){const e=t.reduce(((t,e)=>(t[e.row[0]]=e.row[1],t)),{});return M("Loaded metadata",e),e}throw new Error("Could not load metadata")})).then((r=>{var i,n,o,s,a,u,h,l,d;const c=Object.assign({},t),f=null===(n=null===(i=r.format)||void 0===i?void 0:i.toLowerCase)||void 0===n?void 0:n.call(i);_[f]||console.warn("Unknown tile format",f),c.projection=null!==(o=t.projection)&&void 0!==o?o:"EPSG:3857",c.attributions=null!==(s=r.attribution)&&void 0!==s?s:r.description,c.maxZoom=null!==(a=t.maxZoom)&&void 0!==a?a:+r.maxzoom,c.minZoom=null!==(u=t.minZoom)&&void 0!==u?u:+r.minzoom;const v=null===(l=null===(h=(0,p.Jt)(c.projection))||void 0===h?void 0:h.getExtent)||void 0===l?void 0:l.call(h),g=r.bounds,m=g?(0,p.DI)(g.split(",").map((t=>+t)),"EPSG:4326",c.projection):v;if("raster"===_[f].type){if(void 0===c.maxZoom||void 0===c.minZoom||void 0===v)throw new Error("Cannot determine tilegrid, need minZoom, maxZoom");const t=[(0,y.RG)(v)/256];for(let e=1;e<=c.maxZoom;e++)t.push(t[t.length-1]/2);const e=null!==(d=_[f].mime)&&void 0!==d?d:f;c.mime=e,c.tileGrid=new w.A({origin:[v[0],v[2]],extent:m,minZoom:c.minZoom,resolutions:t})}else c.extent=v;return c.pool=e,c.url=t.url,c})).catch((t=>e.then((t=>t.close())).then((()=>Promise.reject(t)))))}class V extends x.Ay{constructor(t){var e,r,i;super(),t=t||{},this.dataProjection=new F.A({code:"",units:"tile-pixels"}),this.featureClass_=t.featureClass?t.featureClass:k.Ay,this.geometryName_=null!==(e=t.geometryName)&&void 0!==e?e:"Geometry",this.layers_=null!==(r=t.layers)&&void 0!==r?r:null,this.idProperty_=t.idProperty,this.extent=null!==(i=t.extent)&&void 0!==i?i:4096,this.supportedMediaTypes=["application/vnd-mbtiles"]}readFeature(t,e){const r=t.properties;let i;this.idProperty_?(i=r[this.idProperty_],delete r[this.idProperty_]):i=t.id;const n=t.loadGeometry(),o=[],s=[],a=V.MBTypes[n.length>1?"multi":"mono"][t.type];if("Unknown"===a)return null;for(let t=0;t<n.length;t++)if(0!=n[t].length){for(let e=0;e<n[t].length;e++)o.push(n[t][e].x,n[t][e].y);s.push(o.length)}const u=new this.featureClass_(a,o,s,2,r,i);return(null==e?void 0:e.dataProjection)&&"transform"in u&&u.transform(null==e?void 0:e.dataProjection),u}readFeatures(t,e){const r=this.layers_,i=[],n=new m.VectorTile(new g(b.Ay.ungzip(t)));e=this.adaptOptions(e);const o=(0,p.Jt)(null==e?void 0:e.dataProjection),s=null==e?void 0:e.extent;if(!o||!e||!s)throw new Error("Cannot determine the projection/extent");o.setWorldExtent(s),o.setExtent([0,0,this.extent,this.extent]),e.dataProjection=o;for(const t of Object.keys(n.layers)){if(r&&!r.includes(t))continue;const o=n.layers[t];for(let r=0;r<o.length;r++){const n=o.feature(r),s=this.readFeature(n,e);s.getProperties().layer=t,i.push(s)}}return i}readProjection(){return this.dataProjection}}V.MBTypes={mono:["Unknown","Point","LineString","Polygon"],multi:["Unknown","MultiPoint","MultiLineString","Polygon"]};class T extends v.A{constructor(t){var e;if(void 0===t.url&&void 0===t.pool)throw new Error("Must specify url");super(Object.assign(Object.assign({},t),{url:void 0,format:new V({layers:t.layers}),tileUrlFunction:e=>`${t.url}#${e[0]}:${e[1]}:${e[2]}`})),this.setTileLoadFunction(this.tileLoader.bind(this)),this.pool=null!==(e=t.pool)&&void 0!==e?e:c(E(t)).then((e=>e.open(t.url).then((()=>e))))}tileLoader(t,e){const r=t;M("loading tile",[r.tileCoord[0],r.tileCoord[1],r.tileCoord[2]]),r.setLoader(((t,e,i)=>{this.pool.then((t=>t.exec("SELECT tile_data FROM tiles WHERE zoom_level = $zoom AND tile_column = $col AND tile_row = $row",{$zoom:r.tileCoord[0],$col:r.tileCoord[1],$row:(1<<r.tileCoord[0])-1-r.tileCoord[2]}))).then((e=>{if(e&&e[0]&&e[0].row[0]){const n=r.getFormat().readFeatures(e[0].row[0],{extent:t,featureProjection:i});return r.setFeatures(n),void r.onLoad(n,i)}throw new Error(`No data for ${r.tileCoord}`)})).catch((t=>{M(t),r.onError()}))}))}disposeInternal(){return this.pool.then((t=>t.close()))}}class C extends P.A{constructor(t){var e;if(void 0===t.url&&void 0===t.pool)throw new Error("Must specify url");super(Object.assign(Object.assign({},t),{url:void 0,tileUrlFunction:e=>`${t.url}#${e[0]}:${e[1]}:${e[2]}`})),this.setTileLoadFunction(this.tileLoader.bind(this)),this.pool=null!==(e=t.pool)&&void 0!==e?e:c(E(t)).then((e=>e.open(t.url).then((()=>e)))),this.mime=t.mime}tileLoader(t,e){M("loading tile",[t.tileCoord[0],t.tileCoord[1],t.tileCoord[2]]);const r=t.getImage();this.pool.then((e=>e.exec("SELECT tile_data FROM tiles WHERE zoom_level = $zoom AND tile_column = $col AND tile_row = $row",{$zoom:t.tileCoord[0],$col:t.tileCoord[1],$row:(1<<t.tileCoord[0])-1-t.tileCoord[2]}))).then((e=>{if(!(e&&e[0]&&e[0].row[0]instanceof Uint8Array))throw new Error(`No data for ${t.tileCoord}`);{const t=new Blob([e[0].row[0]],{type:this.mime}),i=URL.createObjectURL(t);r.src=i}})).catch((e=>{M(e),t.setState(S.A.ERROR)}))}disposeInternal(){return this.pool.then((t=>t.close()))}}},8217:(t,e,r)=>{"use strict";r.d(e,{Ay:()=>y,Bs:()=>g,hX:()=>w,te:()=>m});var i=r(6717),n=r(4778),o=r(4294),s=r(1217),a=r(1064),u=r(503),h=r(6702),l=r(2871),d=r(4338),c=r(4087),f=r(3407),p=r(3402);const y=class{constructor(){this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.featureClass=i.A,this.supportedMediaTypes=null}getReadOptions(t,e){if(e){let r=e.dataProjection?(0,f.Jt)(e.dataProjection):this.readProjection(t);e.extent&&r&&"tile-pixels"===r.getUnits()&&(r=(0,f.Jt)(r),r.setWorldExtent(e.extent)),e={dataProjection:r,featureProjection:e.featureProjection}}return this.adaptOptions(e)}adaptOptions(t){return Object.assign({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection,featureClass:this.featureClass},t)}getType(){return(0,c.b0)()}readFeature(t,e){return(0,c.b0)()}readFeatures(t,e){return(0,c.b0)()}readGeometry(t,e){return(0,c.b0)()}readProjection(t){return(0,c.b0)()}writeFeature(t,e){return(0,c.b0)()}writeFeatures(t,e){return(0,c.b0)()}writeGeometry(t,e){return(0,c.b0)()}};function w(t,e,r){const i=r?(0,f.Jt)(r.featureProjection):null,n=r?(0,f.Jt)(r.dataProjection):null;let o=t;if(i&&n&&!(0,f.tI)(i,n)){e&&(o=t.clone());const r=e?i:n,s=e?n:i;"tile-pixels"===r.getUnits()?o.transform(r,s):o.applyTransform((0,f.RG)(r,s))}if(e&&r&&void 0!==r.decimals){const e=Math.pow(10,r.decimals),i=function(t){for(let r=0,i=t.length;r<i;++r)t[r]=Math.round(t[r]*e)/e;return t};o===t&&(o=t.clone()),o.applyTransform(i)}return o}const v={Point:o.A,LineString:s.A,Polygon:a.Ay,MultiPoint:u.A,MultiLineString:h.A,MultiPolygon:l.A};function g(t,e){const r=t.geometry;if(!r)return[];if(Array.isArray(r))return r.map((e=>g({...t,geometry:e}))).flat();const i="MultiPolygon"===r.type?"Polygon":r.type;if("GeometryCollection"===i||"Circle"===i)throw new Error("Unsupported geometry type: "+i);const o=r.layout.length;return w(new n.Ay(i,"Polygon"===i?function(t,e,r){return Array.isArray(e[0])?((0,p.mb)(t,0,e,r)||(t=t.slice(),(0,p.NK)(t,0,e,r)),t):((0,p.PA)(t,0,e,r)||(t=t.slice(),(0,p.ug)(t,0,e,r)),t)}(r.flatCoordinates,r.ends,o):r.flatCoordinates,r.ends?.flat(),o,t.properties||{},t.id).enableSimplifyTransformed(),!1,e)}function m(t,e){if(!t)return null;if(Array.isArray(t)){const r=t.map((t=>m(t,e)));return new d.A(r)}return w(new(0,v[t.type])(t.flatCoordinates,t.layout,t.ends),!1,e)}}}]);